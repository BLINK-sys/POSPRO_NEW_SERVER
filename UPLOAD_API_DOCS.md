# üì∏ API –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ —Ç–æ–≤–∞—Ä–æ–≤

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞
- **–†–∞–Ω—å—à–µ:** –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –Ω–∞ –¥–∏—Å–∫, –Ω–æ URL –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–ª—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **–¢–µ–ø–µ—Ä—å:** –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `ProductMedia`

## üöÄ API Endpoints

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Ç–æ–≤–∞—Ä–∞

#### `POST /upload/upload_product`
**–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ**

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file` - —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `product_id` - ID —Ç–æ–≤–∞—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** PNG, JPG, JPEG, GIF
- **–í–∏–¥–µ–æ:** MP4, MOV, AVI, MKV, WMV, FLV, WEBM

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:5000/upload/upload_product \
  -F "file=@image.jpg" \
  -F "product_id=1"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "File uploaded and saved to database",
  "url": "/uploads/products/1/image.jpg",
  "id": 123,
  "media_type": "image",
  "filename": "image.jpg"
}
```

#### `POST /upload/upload_product_image`
**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (—Ç–æ—Ç –∂–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

#### `POST /upload/upload_product_video`
**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≤–∏–¥–µ–æ** (—Ç–æ—Ç –∂–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Ç–æ–≤–∞—Ä–∞

#### `GET /upload/media/{product_id}`
**–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Ç–æ–≤–∞—Ä–∞**

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:5000/upload/media/1
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 123,
    "url": "/uploads/products/1/image.jpg",
    "media_type": "image",
    "order": 0
  },
  {
    "id": 124,
    "url": "/uploads/products/1/video.mp4",
    "media_type": "video",
    "order": 1
  }
]
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞ –ø–æ URL

#### `POST /upload/media/{product_id}`
**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞ –ø–æ URL (–¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫)**

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):**
```json
{
  "url": "https://example.com/image.jpg",
  "media_type": "image"
}
```

### 4. –£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞

#### `DELETE /upload/media/{media_id}`
**–£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞ –∏ —Ñ–∞–π–ª–∞ —Å –¥–∏—Å–∫–∞**

### 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

#### `POST /upload/media/reorder/{product_id}`
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤**

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (JSON):**
```json
[
  {"id": 123, "order": 0},
  {"id": 124, "order": 1}
]
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –§—É–Ω–∫—Ü–∏—è `sync_media_from_filesystem(product_id)`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î –¥–ª—è —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –Ω–∞ –¥–∏—Å–∫–µ, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –ë–î
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –º–µ–¥–∏–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `ProductMedia`
```sql
CREATE TABLE product_media (
    id INTEGER PRIMARY KEY,
    product_id INTEGER NOT NULL,
    url VARCHAR(500) NOT NULL,
    media_type VARCHAR(10) NOT NULL,  -- 'image' –∏–ª–∏ 'video'
    order INTEGER DEFAULT 0
);
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

```
uploads/
‚îî‚îÄ‚îÄ products/
    ‚îî‚îÄ‚îÄ {product_id}/
        ‚îú‚îÄ‚îÄ image1.jpg
        ‚îú‚îÄ‚îÄ image2.png
        ‚îú‚îÄ‚îÄ video1.mp4
        ‚îú‚îÄ‚îÄ documents/
        ‚îÇ   ‚îî‚îÄ‚îÄ document1.pdf
        ‚îî‚îÄ‚îÄ drivers/
            ‚îî‚îÄ‚îÄ driver1.zip
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 20MB
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ë–î, —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è —Å –¥–∏—Å–∫–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –û—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
python test_upload.py
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### JavaScript (Frontend)
```javascript
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('product_id', '1');

fetch('/upload/upload_product', {
  method: 'POST',
  body: formData
})
.then(response => response.json())
.then(data => {
  console.log('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω:', data);
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
fetch('/upload/media/1')
.then(response => response.json())
.then(media => {
  console.log('–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã:', media);
});
```

### Python (Backend)
```python
import requests

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
with open('image.jpg', 'rb') as f:
    files = {'file': ('image.jpg', f, 'image/jpeg')}
    data = {'product_id': '1'}
    
    response = requests.post('http://localhost:5000/upload/upload_product', 
                           files=files, data=data)
    print(response.json())

# –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
response = requests.get('http://localhost:5000/upload/media/1')
media_files = response.json()
print(media_files)
```

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤ –ë–î** - –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `ProductMedia`
2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–µ–¥–∏–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ –ë–î
5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤
6. **–£–ª—É—á—à–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ JSON –æ—Ç–≤–µ—Ç–∞—Ö 